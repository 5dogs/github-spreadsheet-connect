# セットアップガイド

このガイドでは、GitHub Spreadsheet Connectの詳細なセットアップ手順を説明します。

## 📋 前提条件

- Google アカウント
- GitHub アカウント
- 管理したいGoogle スプレッドシート
- GitHubリポジトリ（既存または新規作成）

## 🔧 ステップ1: Google Apps Script プロジェクトの作成

### 1.1 Google Apps Script にアクセス

1. [Google Apps Script](https://script.google.com/) にアクセス
2. Google アカウントでログイン
3. 「新しいプロジェクト」をクリック

### 1.2 プロジェクトの基本設定

1. プロジェクト名を「GitHub Spreadsheet Connect」に変更
2. 必要に応じて説明を追加
3. 「保存」をクリック

## 📝 ステップ2: コードの配置

### 2.1 コードのコピー

1. このリポジトリの `GAS.js` ファイルの内容をコピー
2. Google Apps Scriptエディタの `Code.gs` に貼り付け
3. 「保存」をクリック

### 2.2 ファイル名の確認

- デフォルトでは `Code.gs` という名前になっています
- 必要に応じて `GAS.js` などに変更可能

## 🔑 ステップ3: GitHub Personal Access Token の取得

### 3.1 GitHub にアクセス

1. [GitHub Settings > Developer settings > Personal access tokens](https://github.com/settings/tokens) にアクセス
2. GitHub アカウントでログイン

### 3.2 トークンの生成

1. 「Generate new token (classic)」をクリック
2. 以下の設定を行う：
   - **Note**: `GitHub Spreadsheet Connect` など分かりやすい名前
   - **Expiration**: 必要に応じて有効期限を設定（推奨：90日）
   - **Scopes**: `repo` にチェック（Full control of private repositories）

### 3.3 トークンの保存

1. 「Generate token」をクリック
2. 表示されたトークンをコピー（重要：この画面を閉じると再表示されません）
3. 安全な場所に一時保存

## ⚙️ ステップ4: スクリプトプロパティの設定

### 4.1 プロジェクト設定を開く

1. Google Apps Scriptエディタの左側メニューから「プロジェクトの設定」をクリック
2. 「スクリプトプロパティ」タブを選択

### 4.2 プロパティの追加

以下のプロパティを順番に追加：

| プロパティ名 | 値 | 説明 |
|-------------|-----|------|
| `GITHUB_TOKEN` | `ghp_xxxxxxxxxxxx` | 先ほど取得したGitHub Personal Access Token |
| `COMMITTER_NAME` | `Your Name` | コミット時に表示される名前（オプション） |
| `COMMITTER_EMAIL` | `your@email.com` | コミット時に表示されるメール（オプション） |

### 4.3 プロパティの保存

1. 各プロパティを入力後、「スクリプトプロパティを追加」をクリック
2. すべてのプロパティが追加されていることを確認
3. 「完了」をクリック

## 🎯 ステップ5: 設定の確認

### 5.1 設定情報の確認

1. `getConfig()` 関数を選択
2. 「実行」ボタンをクリック
3. 実行ログで設定情報が正しく読み込まれているか確認

### 5.2 接続テスト

1. `testGitHubConnection()` 関数を選択
2. 「実行」ボタンをクリック
3. GitHubリポジトリへの接続が成功することを確認

## 🚀 ステップ6: 初回実行

### 6.1 手動実行

1. `updateSpreadsheetToGitHub()` 関数を選択
2. 「実行」ボタンをクリック
3. 初回実行時は認証が必要（必要に応じて権限を許可）

### 6.2 実行結果の確認

1. 「実行」タブでログを確認
2. 各シートの処理状況、アップロード結果を確認
3. GitHubリポジトリの `01/` フォルダにCSVファイルが作成されているか確認

## ⏰ ステップ7: 自動実行の設定

### 7.1 トリガーの設定

1. `setupAutoSync()` 関数を選択
2. 「実行」ボタンをクリック
3. 1時間ごとに実行されるトリガーが設定される

### 7.2 トリガーの確認・変更

1. 左側メニューから「トリガー」をクリック
2. 設定されたトリガーを確認
3. 必要に応じて実行頻度を変更

## 🔍 トラブルシューティング

### よくある問題と解決方法

#### 1. GitHubトークンエラー

**症状**: `GitHubトークンが設定されていません` エラー

**解決方法**:
1. スクリプトプロパティに `GITHUB_TOKEN` が正しく設定されているか確認
2. トークンが有効期限内か確認
3. トークンに `repo` 権限が付与されているか確認

#### 2. 認証エラー

**症状**: `GitHub API エラー: 401` または `403`

**解決方法**:
1. GitHubトークンの権限を確認
2. リポジトリへのアクセス権限を確認
3. トークンが正しくコピーされているか確認

#### 3. ファイルアップロードエラー

**症状**: 特定のファイルでアップロード失敗

**解決方法**:
1. シート名に特殊文字が含まれていないか確認
2. ファイルサイズが大きすぎないか確認
3. GitHub APIのレート制限に引っかかっていないか確認

#### 4. トリガーが動作しない

**症状**: 自動実行が行われない

**解決方法**:
1. トリガーが正しく設定されているか確認
2. 関数名が正しいか確認
3. エラーが発生していないかログを確認

### ログの確認方法

1. Google Apps Scriptエディタの「実行」タブを開く
2. 実行履歴から該当する実行を選択
3. ログの内容を確認し、エラーメッセージを特定

## 📚 追加リソース

- [Google Apps Script 公式ドキュメント](https://developers.google.com/apps-script)
- [GitHub API 公式ドキュメント](https://docs.github.com/en/rest)
- [Google Sheets API 公式ドキュメント](https://developers.google.com/sheets/api)

## 🆘 サポート

セットアップで問題が発生した場合：

1. 実行ログの内容を確認
2. エラーメッセージを記録
3. [Issues](../../issues) で既存の問題を検索
4. 新しいIssueを作成して詳細を報告

---

**注意**: このガイドは基本的なセットアップ手順を説明しています。環境や設定によって手順が異なる場合があります。
